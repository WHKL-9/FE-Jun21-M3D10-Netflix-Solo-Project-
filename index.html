<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="netflix.css" />
    <!-- font awesome css -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- own css -->

    <title>Home</title>
  </head>
  <body>
    <!-- Nav Bar section -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-2">
      <a class="navbar-brand" href="#">
        <img
          src="./assets/01_Netflix_Logo/01_Netflix_Logo_RGB/Netflix_Logo_RGB.png"
          alt="netflix-logo"
        />
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav d-flex w-100">
          <li class="nav-item">
            <a class="nav-link active" href="./index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./backoffice.html"
              >Backoffice<span class="sr-only">(current)</span></a
            >
          </li>

          <!-- position these items to the right || ml-auto-->

          <!-- search logo  -->
          <li class="nav-item ml-auto">
            <a class="nav-link" href="#"><i class="fas fa-search"></i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-bell"></i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-user"></i></a>
          </li>
        </ul>
      </div>
    </nav>

    <h5 class="m-2 text-center text-white">All Movies</h5>

    <div class="d-flex justify-content-center">
      <div class="spinner-grow" id="loader" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>

    <div class="allMoviesContainer m-5"></div>

    <!-- Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
      crossorigin="anonymous"
    ></script>

    <!-- own JS -->
    <script>
      const API_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTFjZjE4YzJkNTI2MjAwMTViNmRjOTIiLCJpYXQiOjE2MzUxNTczNzUsImV4cCI6MTYzNjM2Njk3NX0.SiQwb-5PQumcKNmJihl_dm7xX7Hb0NGM_1O9zO0m85I";
      //Sci-fi movies categories
      const url = "https://striveschool-api.herokuapp.com/api/movies/";

      // loader/spinner
      const isLoading = (loading) => {
        if (loading) {
          document.getElementById("loader").classList.remove("d-none");
        } else {
          document.getElementById("loader").classList.add("d-none");
        }
      };

      //function to get movie categories
      const getAllMovieCategories = async () => {
        try {
          const response = await fetch(url, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${API_KEY}`,
            },
          });

          const allCategories = await response.json();

          return allCategories;
        } catch (error) {}
      };

      const movieCategories = [];
      // function to display movie categories
      const displayMovieCategories = (categories) => {
        //target all movie container

        const getAllMoviesContainer = document.querySelector(
          ".allMoviesContainer"
        );

        // create categories dynamically  - fetch from movie

        categories.forEach((category) => {
          getAllMoviesContainer.innerHTML += `<h6 class="text-white ml-5">${category}</h6>
                <div class="row ${category} ml-5 mb-3">
                   
                </div>`;

          movieCategories.push(category);
        });
      };

      //function to fetch movies from API
      const getAllMovies = () => {
        movieCategories.forEach(async (movie) => {
          try {
            const response = await fetch(url + movie, {
              method: "GET",
              headers: {
                Authorization: `Bearer ${API_KEY}`,
              },
            });

            if (response.ok) {
              const allMovies = await response.json();
              console.log(allMovies);
              displayMoviesInCategories(allMovies);
            }
          } catch (error) {}
        });
      };

      //adding movies in their respective categories
      // fetch from their respective categories --- movies/category
      const displayMoviesInCategories = (movies) => {
        //target the categories the movies belong to || pre-added the classes in the step above
        const movieContainer = document.querySelector(`.${movies[0].category}`);

        movies.forEach((movie) => {
          movieContainer.innerHTML += `
        <a href="./backoffice.html?id=${movie._id}" class="movieLink card col col-sm-6 col-md-4 col-lg-4 p-1 mr-3 movieCard">
                <img class="card-img-top movie-image w-100" src="${movie.imageUrl}" alt="movie image">
                <div class="card-body pt-1 p-0">
                    <p class="card-title text-center movieLink">${movie.name}</p>          
                </div>
    
        </a>  `;
        });
      };

      //fetch available movies from our API
      window.onload = async () => {
        try {
          //to show the spinner when fetching from API
          isLoading(true);

          const allMovieCategories = await getAllMovieCategories();

          displayMovieCategories(allMovieCategories);

          getAllMovies(); //get and display in each fetch
        } catch (error) {
          console.log(error);
        } finally {
          //to hide the spinner
          isLoading(false);
        }
      };
    </script>
  </body>
</html>
